# HAProxy to Envoy Migration Tool

This project is a migration tool that converts HAProxy configurations to Envoy configurations. It parses an HAProxy configuration file and generates an Envoy-compatible YAML configuration file.

## Project Structure

```
haproxy-to-envoy/
│
├── src/
│   ├── __init__.py
│   ├── parsers/
│   │   ├── __init__.py
│   │   └── haproxy_parser.py
│   ├── generators/
│   │   ├── __init__.py
│   │   └── envoy_generator.py
│   └── utils/
│       ├── __init__.py
│       └── config_utils.py
│
├── tests/
│   ├── __init__.py
│   ├── test_haproxy_parser.py
│   └── test_envoy_generator.py
│
├── config/
│   └── haproxy.cfg
│
├── output/
│   └── envoy.yaml
│
├── main.py
├── requirements.txt
└── README.md
```

## Features

1. Parses HAProxy configuration files
2. Converts HAProxy backends to Envoy clusters
3. Converts HAProxy frontends to Envoy listeners
4. Handles basic routing rules
5. Generates an Envoy YAML configuration file

## Prerequisites

- Python 3.7+
- pip (Python package installer)
- venv (Python virtual environment)

## Installation

1. Clone this repository:
   ```
   git clone https://github.com/MELJOESTEIN/haproxy-to-envoy.git
   cd haproxy-to-envoy
   ```

2. Create a virtual environment:
   ```
   python3 -m venv venv
   ```

3. Activate the virtual environment:
   - On Unix or MacOS:
     ```
     source venv/bin/activate
     ```
   - On Windows:
     ```
     venv\Scripts\activate
     ```

4. Install dependencies:
   ```
   pip install -r requirements.txt
   ```

## Usage

1. Ensure your virtual environment is activated.

2. Place your HAProxy configuration file in the `config/` folder and name it `haproxy.cfg`.

3. Run the main script:
   ```
   python main.py
   ```

4. The generated Envoy configuration file will be saved in `output/envoy.yaml`.

5. When you're done, you can deactivate the virtual environment:
   ```
   deactivate
   ```

## Component Details

### main.py

This is the entry point of the script. It orchestrates the conversion process by calling the appropriate functions from other modules.

### src/parsers/haproxy_parser.py

This module contains the `parse_haproxy_config()` function that parses the HAProxy configuration file and converts it into a Python data structure. It handles different sections of the HAProxy configuration (global, defaults, frontends, backends) and processes each line accordingly.

### src/generators/envoy_generator.py

This module contains the `generate_envoy_config()` function that takes the data structure generated by the HAProxy parser and converts it into an Envoy configuration. It creates Envoy listeners from HAProxy frontends and Envoy clusters from HAProxy backends.

### src/utils/config_utils.py

This module contains utility functions for loading and saving YAML files. It provides a consistent interface for file operations across the project.

## Current Limitations

- Limited handling of complex routing rules
- No support for all advanced HAProxy features (e.g., stick tables, custom ACLs)
- The conversion may require manual adjustments for very complex configurations
- SSL/TLS configuration is not fully supported and may need manual intervention
- Health check configurations may need to be adjusted manually in the Envoy configuration

## Contributing

Contributions are welcome! Here are some ways you can contribute to this project:

1. Report bugs: If you encounter any bugs, please let us know by opening an issue.
2. Suggest enhancements: If you have ideas for new features or improvements, we'd love to hear them.
3. Add new features: Implement new features, improve existing ones, or fix known issues.
4. Improve documentation: If you see a need for additional documentation, go ahead and create it.

When contributing, please follow these steps:

1. Fork the repository.
2. Create a new branch for your feature or bug fix.
3. Commit your changes.
4. Push your branch and open a pull request with a clear description of your changes.

Please ensure your code adheres to the existing style to maintain consistency.

## License

[Insert your chosen license here, e.g., MIT, GPL, etc.]

## Acknowledgements

This project was inspired by the need to migrate from HAProxy to Envoy in modern cloud-native environments. We thank the open-source community for providing the tools and libraries that made this project possible.